# MnemoShare Stack - Complete Deployment Configuration
#
# Quick Start: Just run `helm install mnemoshare-stack ./mnemoshare-stack`
# with defaults to get a fully working evaluation environment.
#
# For production, disable bundled services and configure external ones.

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# Choose ONE: bundled PostgreSQL OR external database

# Option 1: Bundled PostgreSQL (default for evaluation)
postgresql:
  enabled: true
  auth:
    database: mnemoshare
    username: mnemoshare
    password: "mnemoshare-secret-change-me"
    postgresPassword: "postgres-admin-change-me"
  primary:
    persistence:
      enabled: true
      size: 10Gi
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 500m

# Option 2: External Database (set postgresql.enabled=false)
externalDatabase:
  # type: postgres or mongodb
  type: postgres
  # For PostgreSQL:
  host: ""
  port: 5432
  database: mnemoshare
  username: ""
  password: ""
  # Full DSN (alternative to individual fields):
  # dsn: "postgres://user:pass@host:5432/mnemoshare?sslmode=require"
  # For MongoDB:
  # uri: "mongodb+srv://user:pass@cluster.mongodb.net/mnemoshare"

# =============================================================================
# STORAGE CONFIGURATION
# =============================================================================
# Choose ONE: bundled MinIO OR external S3-compatible storage

# Option 1: Bundled MinIO (default for evaluation)
# Uses official MinIO chart from charts.min.io
minio:
  enabled: true
  mode: standalone
  rootUser: "minioadmin"
  rootPassword: "minio-secret-change-me"
  persistence:
    enabled: true
    size: 50Gi
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 2Gi
      cpu: 1000m

# Option 2: External S3-compatible Storage (set minio.enabled=false)
externalStorage:
  enabled: false
  # type: s3, gcs, azure-blob, minio
  type: s3
  # S3 / MinIO:
  endpoint: "s3.amazonaws.com"  # Or your MinIO endpoint
  region: "us-east-1"
  bucket: "mnemoshare-files"
  accessKey: ""
  secretKey: ""
  useSSL: true

# =============================================================================
# CLAMAV ANTIVIRUS (Recommended)
# =============================================================================
clamav:
  enabled: true
  image:
    repository: mnemoshare/clamav-icap
    tag: "0.7.5"
    pullPolicy: IfNotPresent
  persistence:
    enabled: true
    size: 500Mi
  resources:
    requests:
      memory: 1Gi
      cpu: 200m
    limits:
      memory: 2Gi
      cpu: 1000m

# =============================================================================
# MNEMOSHARE APPLICATION
# =============================================================================
mnemoshare:
  replicaCount: 2

  image:
    repository: mnemoshare/mnemoshare
    tag: ""  # Defaults to appVersion (0.7.8)
    pullPolicy: IfNotPresent

  # Database driver - use postgres for this stack
  database:
    driver: "postgres"

  # License key (optional - can be entered in Settings page)
  # Get a license at https://mnemoshare.com/pricing
  license:
    key: ""

  # Security settings
  jwt:
    secret: ""  # Auto-generated if empty
    expiration: "24h"

  encryption:
    key: ""  # Auto-generated if empty (32 bytes for AES-256)

  # S3 configuration - auto-configured from MinIO above
  s3:
    bucket: "mnemoshare-files"

  # Redis - enabled for workflow workers (uses mnemoshare chart's built-in Redis)
  redis:
    enabled: true
    password: "redis-secret-change-me"
    persistence:
      enabled: true
      size: 5Gi
    resources:
      requests:
        memory: 128Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 500m

  # Workflow Workers - enabled by default in stack
  workflowWorker:
    enabled: true
    replicas: 2
    concurrency: 3
    persistence:
      enabled: true
      size: 10Gi
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 2Gi
    autoscaling:
      enabled: false  # KEDA autoscaling (requires KEDA installed)
      minReplicas: 1
      maxReplicas: 5
      listLengthTarget: 5

  # Ingress
  ingress:
    enabled: true
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/proxy-body-size: "0"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    hosts:
      - host: mnemoshare.local
        paths:
          - path: /
            pathType: Prefix
    tls: []

  # Resources
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 2Gi
      cpu: 1000m

  # Autoscaling
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80

  # Probes
  livenessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10

  readinessProbe:
    httpGet:
      path: /health
      port: http
    initialDelaySeconds: 10
    periodSeconds: 5

# =============================================================================
# GLOBAL SETTINGS
# =============================================================================
global:
  # Storage class for all PVCs (leave empty for default)
  storageClass: ""

  # Image pull secrets (if using private registry)
  imagePullSecrets: []

# Override names
nameOverride: ""
fullnameOverride: ""
