{{- if or (not .Values.existingSecrets.mongodb) (not .Values.existingSecrets.postgres) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "mnemoshare.fullname" . }}-secrets
  labels:
    {{- include "mnemoshare.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- if and (eq .Values.database.driver "mongodb") (not .Values.existingSecrets.mongodb) }}
  mongodb-uri: {{ .Values.mongodb.external.uri | quote }}
  {{- end }}
  {{- if and (eq .Values.database.driver "postgres") (not .Values.existingSecrets.postgres) }}
  postgres-dsn: {{ .Values.postgres.dsn | quote }}
  {{- end }}
  s3-access-key: {{ .Values.s3.accessKey | quote }}
  s3-secret-key: {{ .Values.s3.secretKey | quote }}
  # JWT and encryption keys are auto-generated if not provided
  jwt-secret: {{ include "mnemoshare.jwtSecret" . | quote }}
  encryption-key: {{ include "mnemoshare.encryptionKey" . | quote }}
  license-key: {{ .Values.license.key | quote }}
  {{- if .Values.sendgrid.apiKey }}
  sendgrid-api-key: {{ .Values.sendgrid.apiKey | quote }}
  {{- end }}
  {{- if .Values.turnstile.secretKey }}
  turnstile-secret-key: {{ .Values.turnstile.secretKey | quote }}
  {{- end }}
{{- end }}
